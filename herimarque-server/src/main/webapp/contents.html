<!DOCTYPE html>
<html>
<head>
<script type="text/javascript"
	src="http://code.jquery.com/jquery-1.7.1.js"></script>
<script type="text/javascript" src="admincookie.js"></script>
</head>
<body>
	<h1>Contents Manage</h1>
	<h2>File Upload with Jersey</h2>
	<form name="uploadForm" id="uploadForm" method="post"
		onsubmit="setAction(this)" enctype="multipart/form-data"
		accept-charset="UTF-8">
		ID <input type="text" name="id" id="id" value="tuser" /> <br> Upload
		file<br> <input type="file" name="map" size="45" /> <input
			type="file" name="image" size="45" /> <input type="file"
			name="image" size="45" /> <br>
		<textarea rows="3" cols="50" name="mapInfo">
{area:["서울", "경남"], timeline:[{type:"g", x:"10.1111", y:"12.1111"},{type:"i", x:"12.12412", y:"53.351351"}], title:"title", content:"testComment",user:"tuser"}
		</textarea>
		<br> <input type="submit" value="Upload">
	</form>
	<div class="uploadResult"></div>
	<div class="addComment">
		<h2>Add Comment to the map</h2>
		mapKey:<input type="text" id="mapkey"
			value="e11a088801c1e26a40c9a05861acd071"><br> id:<input
			type="text" id="id" value="testId"><br> contents:<input
			type="text" id="contents"><br> <input type="button"
			id="addComment" value="addIt">
		<div class="addCommentResult"></div>
	</div>
	<div class="periodFind"></div>
	<div class="likeMap">
		<h2>Like Map</h2>
		id:<input type="text" id="likeUser" value="testId"><br>
		mapKey:<input type="text" id="likeMapKey"
			value="72f852e2aa091459f603e2c86c123bce"><br>
		<button id="likeMap">Like</button>
		<div class="likeMapResult"></div>
	</div>
	<div class="unlikeMap">
		<h2>UnLike Map</h2>
		id:<input type="text" id="unlikeUser" value="testId"><br>
		mapKey:<input type="text" id="unlikeMapKey" value="72f852e2aa091459f603e2c86c123bce"><br>
		<button id="unlikeMap">unlikeMap</button>
		<div class="unlikeMapResult"></div>
	</div>
	<div class="userMap">
		<h2>Show Maps of the user</h2>
		id:<input type="text" id="mapUser" value="testId"><br>
		<button id="userMap">show</button>
		<div class="userMapResult"></div>
	</div>
	<div class="hotMaps">
		<h2>Hot Maps</h2>
		<button id="getHots">HotMaps!</button>
		<div class="hotMapsResult"></div>
	</div>
	<button onclick="location.href='index.html'">home</button>
</body>
<script type="text/javascript">
document.body.onload = function(){
	var admin = getCookie("admin");
	console.log(admin);
	if(admin == null || admin == ""){
		$("body").hide();
		location.href = "index.html";
		alert("No info for authenticating admin user");
	}
}
function setAction(form) {
		form.action = "api/c/upload/map/" + $("#id").val();
	}
	$("#addComment").click(
			function() {
				$.ajax({
					type : 'POST',
					url : 'api/c/u/' + $("#mapkey").val(),
					beforeSend : function(xhr) {
						xhr.setRequestHeader("content-type","application/json");
						xhr.setRequestHeader('user', $("#id").val());
					},
					data : {
						content : $("#contents").val()
					},
					statusCode : {
						200 : function() {
							$(".addCommentResult").empty().append(
									"success to add the comment");
						},
						400 : function() {
							$(".addCommentResult").empty().append(
									"Fail to add the comment");
						}
					}
				});
			});

	$("#likeMap").click(
			function() {
				$.ajax({
					type : 'POST',
					url : 'api/c/maps/' + $("#likeUser").val() + "/?map="
							+ $("#likeMapKey").val(),
					success : function() {
						$(".likeMapResult").empty().append(
								"Success to add like to the map!");
						if (data.length > 0) {
							for ( var i = 0; i < data.length; ++i) {
								$(".likeMapResult").append(data[i]);
							}
						} else {
							$(".likeMapResult").append(data);
						}
					}
				});
			});

	$("#unlikeMap").click(function(){
		$.ajax({
			type:'DELETE',
			url : 'api/c/maps/' + $("#unlikeUser").val() + "/?map="+ $("#unlikeMapKey").val(),
			success : function(){
				$('.unlikeMapResult').empty().append("Success to remove user id from the map");
			}
		});
	});
	
	$("#getHots").click(function() {
		$.ajax({
			type : 'GET',
			url : 'api/c/maps/hot',
			beforeSend : function(xhr) {
				xhr.setRequestHeader('user', 'testId');
			},
			statusCode : {
				200 : function(data) {
					$(".hotMapsResult").empty().append("Success to load<br>");
					$(".hotMapsResult").append(data);
				},
				503 : function() {
					$(".hotMapsResult").empty().append("Fail to load");
				}
			}
		});
	});
	$("#userMap").click(function(){
		$.ajax({
			type : 'GET',
			url : 'api/c/maps/user/' + $("#mapUser").val(),
			beforeSend : function(xhr){
				xhr.setRequestHeader('user', 'testId');
			},
			statusCode : {
				200 : function(data) {
					$(".userMapResult").empty().append("Success to load<br>");
					if(data.length > 1){
						console.log(data.length);
						for(var i = 0; i < data.length; ++i){
							setMapView(data[i]);
						}
					}else{
						setMapView(data);
					}
				},
				503 : function() {
					$(".userMapResult").empty().append("Fail to load");
				}
			}
		});
	});
	
	function setMapView(dom){
		console.log(dom);
		var div = document.createElement("div");
		var txt = document.createTextNode('title:' + dom.title);
		div.appendChild(txt);
		
		txt = document.createTextNode('area:' + dom.area);
		div.appendChild(txt);
		
		if(dom.timeline != null){
			for(var i =0; i < dom.timeline.length; ++i){
				if(dom.timeline[i].image != null){
					var img = document.createElement("img");
					img.setAttribute('src', 'api/c/image/testId/title/' +dom.timeline[i].image);
					div.appendChild(img);
				}
			}
		}
		
		$(".userMapResult").append(div);
	}
</script>
</html>